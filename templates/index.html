<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link
    rel="icon"
    href="https://media.discordapp.net/attachments/1343576085098664020/1366231934887399434/image-removebg-preview_4.png?ex=6810dae4&is=680f8964&hm=3541cfcdc557fae800e4603bec2508dcaa17d8ee2634dbb942cf3478c8289c26&=&format=webp&quality=lossless"
    type="image/png"
  />
  <title>Bop Central</title>

  <!-- Open Graph / Facebook Embed -->
  <meta property="og:title" content="Bop Central – TikTok Viewer" />
  <meta
    property="og:description"
    content="Watch TikTok Bops or randoms. Search users, browse latest or top videos, and download your favorites."
  />
  <meta
    property="og:image"
    content="https://media.discordapp.net/attachments/1343576085098664020/1366204471633510530/IMG_20250427_190832_902.jpg?ex=6810c150&is=680f6fd0&hm=7d128535b31463dfba1e9fd139a7ad7ae51b1ec7f08b7a54c09e2bcc5dac131e&=&format=webp"
  />
  <meta property="og:url" content="https://bop-central.onrender.com/" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Bop Central – TikTok Viewer" />
  <meta
    name="twitter:description"
    content="Watch TikTok videos. Search users, browse latest or top videos, and download your favorites."
  />
  <meta
    name="twitter:image"
    content="https://media.discordapp.net/attachments/1343576085098664020/1366204471633510530/IMG_20250427_190832_902.jpg?ex=6810c150&is=680f6fd0&hm=7d128535b31463dfba1e9fd139a7ad7ae51b1ec7f08b7a54c09e2bcc5dac131e&=&format=webp"
  />

  <!-- Prevent indexing -->
  <meta name="robots" content="noindex,nofollow" />

  <style>
    /* disable selection and copying */
    * {
      -webkit-user-select: none !important;
      -moz-user-select: none !important;
      -ms-user-select: none !important;
      user-select: none !important;
    }
    /* reset & base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #000;
      color: #fff;
      font-family: sans-serif;
      overflow-x: hidden;
    }

    /* Loader Screen */
    #loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
      z-index: 9999;
    }
    #loader .spinner {
      width: 60px;
      height: 60px;
      border: 6px solid rgba(255, 255, 255, 0.2);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Auth container */
    #auth-container {
      display: none;
      height: 100vh;
      width: 100%;
      background: #000;
      color: #fff;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    #auth-container img {
      width: 150px;
      margin-bottom: 20px;
      filter: drop-shadow(0 0 10px #8e2de2);
      animation: glowPulse 2s ease-in-out infinite;
    }
    @keyframes glowPulse {
      0%, 100% { filter: drop-shadow(0 0 10px #8e2de2); }
      50%       { filter: drop-shadow(0 0 30px #4a00e0); }
    }
    .tabs { display: flex; margin-bottom: 20px; }
    .tabs button {
      flex: 1; padding: 10px; background: #151515; border: none;
      cursor: pointer; color: #fff; font-weight: bold;
    }
    .tabs button.active { background: #333; }
    .form-container { width: 300px; }
    .form-container form {
      display: none; flex-direction: column; gap: 12px;
    }
    .form-container form.active { display: flex; }
    .form-container input {
      padding: 8px; border-radius: 4px; border: none;
    }
    .form-container button {
      padding: 10px; border: none; border-radius: 4px;
      cursor: pointer; background: #4a00e0; color: #fff;
    }
    .form-error { color: #ff004f; font-size: 0.9rem; }

    /* Main app container */
    #app-content {
      display: none;
      position: relative;
      padding-top: 12rem;
    }

    /* Header & Navigation */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #000;
      z-index: 1000;
    }
    header .logo-container {
      position: absolute;
      left: 20px;
      top: 1rem;
    }
    header img.logo {
      height: 10rem;
    }
    nav {
      display: flex;
      gap: 20px;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-weight: bold;
    }
    nav a.active,
    nav a:hover {
      background: #333;
      color: #ff004f;
    }

    /* Sidebar toggle button */
    #sidebar-toggle {
      position: absolute;
      right: 20px;
      background: none;
      border: none;
      color: #fff;
      font-size: 1.5rem;
      cursor: pointer;
    }

    /* About Us sidebar */
    .about-us {
      position: fixed;
      top: 12rem;
      right: -300px;
      width: 260px;
      background: #111;
      padding: 20px;
      border-radius: 8px;
      font-size: 0.9rem;
      line-height: 1.4;
      transition: right 0.3s ease;
      z-index: 999;
    }
    .about-us.open {
      right: 20px;
    }
    .about-us h2 {
      margin-bottom: 10px;
      font-size: 1.2rem;
      color: #4a00e0;
    }

    /* Page wrappers */
    #page-home,
    #page-urls,
    #page-users,
    #page-videos {
      max-width: 800px;
      margin: 40px auto;
      padding: 0 20px;
    }

    /* Hero */
    .hero {
      border: 2px solid;
      border-image: linear-gradient(90deg, #8e2de2, #00ff6a) 1;
      padding: 2rem;
      margin-bottom: 20px;
      border-radius: 8px;
      text-align: center;
    }

    /* Shared search bar */
    .search-bar {
      width: 100%;
      display: flex;
      margin-bottom: 20px;
    }
    .search-bar input {
      flex: 1;
      padding: 12px;
      border-radius: 4px 0 0 4px;
      border: none;
    }
    .search-bar button {
      padding: 12px 20px;
      border: none;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
      background: #151515;
      color: #fff;
    }
    .search-bar button:hover {
      background: #333;
    }

    /* Video & URL grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .card {
      background: #151515;
      padding: 16px;
      border-radius: 6px;
      text-align: center;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: translateY(-4px);
    }
    .card img,
    .card video {
      width: 100%;
      height: auto;
      margin-bottom: 10px;
      border-radius: 4px;
    }
    .card .title {
      font-size: 1rem;
      margin-top: 6px;
    }
    .card .views {
      font-size: 0.85rem;
      margin-top: 4px;
      color: #aaa;
    }
    .card-buttons {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
    }
    .card-buttons a button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #151515;
      color: #fff;
    }
    .card-buttons a button:hover {
      background: #333;
    }

    /* Delete buttons */
    .delete-user,
    .delete-url {
      display: none;
      margin-top: 8px;
      background: #ff4d4f;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      color: #fff;
      font-size: 0.8rem;
    }

    /* Circular PFP grid for saved users */
    .users-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }
    .user-entry .user-card img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #444;
      margin: 0 auto 8px;
      cursor: pointer;
    }
    .user-entry .user-card {
      text-align: center;
    }
    .videos-container {
      display: none;
      margin-top: 16px;
    }

    /* Admin Password Modal */
    #admin-pass-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.75 );
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }
    #admin-pass-modal .modal-content {
      background: #111;
      padding: 2rem;
      border-radius: 8px;
      width: 320px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      text-align: center;
    }
    #admin-pass-modal h2 {
      margin-bottom: 1rem;
      color: #8e2de2;
      font-size: 1.5rem;
    }
    #admin-pass-modal input {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
    }
    #admin-pass-modal .error {
      color: #ff4d4f;
      margin-bottom: 0.75rem;
      height: 1rem;
    }
    #admin-pass-modal .buttons {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
    }
    #admin-pass-modal .buttons button {
      flex: 1;
      padding: 0.75rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
    }
    #admin-pass-modal .buttons .submit {
      background: #4a00e0;
      color: #fff;
    }
    #admin-pass-modal .buttons .cancel {
      background: #333;
      color: #fff;
    }
  </style>
</head>
<body>
  <!-- Loader -->
  <div id="loader">
    <div class="spinner"></div>
    <img
      id="loader-image"
      src="https://media.discordapp.net/attachments/1343576085098664020/1366231934887399434/image-removebg-preview_4.png"
      alt="Loading…"
    />
  </div>

  <!-- Auth UI -->
  <div id="auth-container">
    <img
      src="https://media.discordapp.net/attachments/1343576085098664020/1366231934887399434/image-removebg-preview_4.png"
      alt="Logo"
    />
    <div class="tabs">
      <button id="tab-login" class="active">Login</button>
      <button id="tab-register">Register</button>
    </div>
    <div class="form-container">
      <form id="form-login" class="active">
        <input type="text" id="login-username" placeholder="Username" required />
        <input type="password" id="login-password" placeholder="Password" required />
        <button type="submit">Login</button>
        <div class="form-error" id="error-login"></div>
      </form>
      <form id="form-register">
        <input type="text" id="reg-username" placeholder="Username" required />
        <input type="password" id="reg-password" placeholder="Password" required />
        <input type="text" id="reg-invite" placeholder="Invite Code" required />
        <button type="submit">Register</button>
        <div class="form-error" id="error-register"></div>
      </form>
    </div>
  </div>

  <!-- Main App -->
  <div id="app-content">
    <header>
      <a href="/" class="logo-container">
        <img
          src="https://media.discordapp.net/attachments/1343576085098664020/1366231934887399434/image-removebg-preview_4.png"
          alt="Bop Central Logo"
          class="logo"
        />
      </a>
      <nav>
        <a href="/" data-view="home">Home</a>
        <a href="/?type=latest" data-view="latest">Latest</a>
        <a href="/?type=top" data-view="top">Top</a>
        <a href="/?view=urls" data-view="urls">Saved URLs</a>
        <a href="/?view=users" data-view="users">Saved Users</a>
      </nav>
      <button id="sidebar-toggle">☰</button>
    </header>

    <!-- About sidebar -->
    <aside class="about-us">
      <h2>About Bop Central</h2>
      <p>
        Bop Central is your go-to TikTok downloader and viewer. Dive into the latest and greatest TikTok “bops” and explore what others
        are sharing. Whether you want to search by username, browse the top trending videos, or fetch and download content via URL,
        Bop Central makes it easy and seamless. Keep up with your favorite creators, discover new interests, and save videos for offline
        viewing—all in one place.
      </p>
    </aside>

    <!-- HOME PAGE -->
    <div id="page-home">
      <section class="hero">
        <h2>Bop Central – Watch & Download TikTok Videos</h2>
        <p>Search users, browse latest or top videos, or fetch by URL.</p>
      </section>
      <form class="search-bar" method="get" action="/">
        <input name="q" type="text" placeholder="Input username…" value="{{ active_q }}" />
        <button type="submit">Go</button>
      </form>
    </div>

    <!-- URLS PAGE -->
    <div id="page-urls" style="display:none;">
      <form class="url-bar" id="url-form">
        <input type="url" id="url-input" placeholder="Enter TikTok video URL…" required />
        <button type="submit">Fetch Video</button>
      </form>
      <section id="url-section" style="display:none;">
        <h3 style="text-align:center;">Result</h3>
        <div class="grid" id="url-grid"></div>
      </section>
    </div>

    <!-- USERS PAGE -->
    <div id="page-users" style="display:none;">
      <!-- USE SAME SEARCH BAR STYLE -->
      <form class="search-bar" id="user-search-form">
        <input type="text" id="user-search" placeholder="Search saved users…" />
        <button type="button">Go</button>
      </form>
      <div class="users-grid"></div>
    </div>

    <!-- VIDEOS PAGE -->
    <div id="page-videos" style="display:none;">
      <section id="videos-section">
        <h3 style="text-align:center;">
          {% if active_q %}
            Results for "{{ active_q }}"
          {% elif view_type == 'latest' %}
            Latest Videos
          {% elif view_type == 'top' %}
            Top Videos
          {% endif %}
        </h3>
        <div class="grid">
          {% for v in user_videos %}
            <div class="card">
              <video controls data-aweme-id="{{ v.aweme_id }}">
                <source src="{{ v.play_url }}" type="video/mp4">
              </video>
              <div class="title">{{ v.text or ("Video " ~ v.aweme_id) }}</div>
              <div class="views" id="views-{{ v.aweme_id }}">{{ v.play_count }} views</div>
              <div class="card-buttons">
                <a href="{{ v.play_url }}"><button type="button">Play</button></a>
                <a href="{{ hd_urls[v.aweme_id] }}"><button type="button">HD</button></a>
              </div>
            </div>
          {% endfor %}
        </div>
      </section>
    </div>
  </div>

  <!-- Admin Password Modal -->
  <div id="admin-pass-modal">
    <div class="modal-content">
      <h2>Admin Access</h2>
      <input type="password" id="admin-pass-input" placeholder="Enter password…" />
      <div class="error" id="admin-pass-error"></div>
      <div class="buttons">
        <button class="submit" id="admin-pass-submit">Unlock</button>
        <button class="cancel" id="admin-pass-cancel">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // Sidebar toggle
    document.getElementById('sidebar-toggle').addEventListener('click', () => {
      document.querySelector('.about-us').classList.toggle('open');
    });

    // Anti-Inspect & Anti-Copy
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('copy', e => e.preventDefault());
    document.addEventListener('cut', e => e.preventDefault());

    // filterUsers (search saved users)
    document.getElementById('user-search-form').addEventListener('submit', e => {
      e.preventDefault();
      const q = document.getElementById('user-search').value.toLowerCase();
      document.querySelectorAll('.user-entry').forEach(entry => {
        const name = entry.querySelector('.handle').textContent.toLowerCase();
        entry.style.display = name.includes(q) ? '' : 'none';
      });
    });

    // Auth handling
    function initAuth() {
      // tab switch
      document.getElementById('tab-login').addEventListener('click', () => {
        document.getElementById('form-login').classList.add('active');
        document.getElementById('form-register').classList.remove('active');
        document.getElementById('tab-login').classList.add('active');
        document.getElementById('tab-register').classList.remove('active');
      });
      document.getElementById('tab-register').addEventListener('click', () => {
        document.getElementById('form-register').classList.add('active');
        document.getElementById('form-login').classList.remove('active');
        document.getElementById('tab-register').classList.add('active');
        document.getElementById('tab-login').classList.remove('active');
      });

      // login
      document.getElementById('form-login').addEventListener('submit', async e => {
        e.preventDefault();
        const user = document.getElementById('login-username').value.trim();
        const pass = document.getElementById('login-password').value;
        const params = new URLSearchParams();
        params.append('username', user);
        params.append('password', pass);
        const res = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: params.toString()
        });
        if (!res.ok) {
          const err = await res.text();
          document.getElementById('error-login').textContent = err || 'Login failed';
          return;
        }
        const data = await res.json();
        localStorage.setItem('tikify_token', data.access_token);
        location.reload();
      });

      // register
      document.getElementById('form-register').addEventListener('submit', async e => {
        e.preventDefault();
        const user = document.getElementById('reg-username').value.trim();
        const pass = document.getElementById('reg-password').value;
        const invite = document.getElementById('reg-invite').value.trim();
        const res = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username: user, password: pass, invite_code: invite })
        });
        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          document.getElementById('error-register').textContent = err.detail || 'Registration failed';
          return;
        }
        document.getElementById('tab-login').click();
        document.getElementById('error-login').textContent = 'Registered! Please log in.';
      });
    }

    // Admin-mode + custom modal
    let adminMode = false;
    const _pw = [98,111,112,112].map(c => String.fromCharCode(c)).join('');
    const modal = document.getElementById('admin-pass-modal');
    const input = document.getElementById('admin-pass-input');
    const error = document.getElementById('admin-pass-error');
    document.addEventListener('keydown', e => {
      if (e.ctrlKey && e.key === '\\') {
        if (!adminMode && modal.style.display !== 'flex') {
          input.value = '';
          error.textContent = '';
          modal.style.display = 'flex';
          setTimeout(() => input.focus(), 100);
        } else {
          adminMode = false;
          document.querySelectorAll('.delete-user, .delete-url').forEach(b => b.style.display = 'none');
        }
      }
      if (e.key === 'Escape') {
        modal.style.display = 'none';
      }
    });
    document.getElementById('admin-pass-submit').addEventListener('click', () => {
      if (input.value === _pw) {
        modal.style.display = 'none';
        adminMode = true;
        document.querySelectorAll('.delete-user, .delete-url').forEach(b => b.style.display = 'block');
      } else {
        error.textContent = 'Wrong password';
      }
    });
    document.getElementById('admin-pass-cancel').addEventListener('click', () => modal.style.display = 'none');

    // delete-user
    function bindDeleteUsers() {
      document.querySelectorAll('.delete-user').forEach(btn => {
        btn.onclick = async () => {
          const u = btn.dataset.username;
          if (!confirm(`Delete user ${u}?`)) return;
          const r = await fetch(`/api/saved-users/${encodeURIComponent(u)}`, { method: 'DELETE' });
          if (r.ok) btn.closest('.user-entry').remove();
          else alert(`Failed to delete ${u}`);
        }
      });
    }

    // delete-url
    function bindDeleteUrls() {
      document.querySelectorAll('.delete-url').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.aweme;
          if (!confirm(`Delete saved URL ${id}?`)) return;
          const r = await fetch(`/api/saved-urls/${encodeURIComponent(id)}`, { method: 'DELETE' });
          if (r.ok) btn.closest('.card').remove();
          else alert(`Failed to delete URL ${id}`);
        }
      });
    }

    // URL form handler
    document.getElementById('url-form').addEventListener('submit', async e => {
      e.preventDefault();
      const url = document.getElementById('url-input').value.trim();
      try {
        const res = await fetch('/api/from-url', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url })
        });
        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          alert(err.detail || 'Failed to resolve URL');
          return;
        }
        const data = await res.json();
        // save then refresh
        await fetch('/api/saved-urls', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        fetchSavedUrls();
      } catch {
        alert('Error fetching video');
      }
    });

    // Highlight nav & view switching
    function highlightNav() {
      const p = new URLSearchParams(location.search);
      const hasQ = !!p.get('q');
      const view = p.get('view') || p.get('type') || (hasQ ? 'videos' : 'home');
      document.querySelectorAll('nav a').forEach(a => {
        a.classList.toggle('active', a.dataset.view === view);
      });
      ['home','urls','users','videos'].forEach(v => {
        const el = document.getElementById('page-' + v);
        el.style.display = (v === view || (['latest','top'].includes(view) && v === 'videos')) ? 'block' : 'none';
      });
    }

    // Fetch & render saved URLs
    async function fetchSavedUrls() {
      const res = await fetch('/api/saved-urls');
      const saved = await res.json();
      renderUrlSection(saved);
    }
    function renderUrlSection(savedUrls) {
      const sec = document.getElementById('url-section');
      const g = document.getElementById('url-grid');
      if (!savedUrls.length) { sec.style.display = 'none'; return; }
      sec.style.display = 'block';
      g.innerHTML = '';
      savedUrls.forEach(v => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <video controls data-aweme-id="${v.aweme_id}">
            <source src="${v.play_url}" type="video/mp4">
          </video>
          <div class="title">Video ${v.aweme_id}</div>
          <div class="views" id="views-${v.aweme_id}">${v.play_count||0} views</div>
          <div class="card-buttons">
            <a href="/download?video_id=${v.aweme_id}&hd=0"><button>Download</button></a>
            <a href="/download?video_id=${v.aweme_id}&hd=1"><button>HD</button></a>
          </div>
          <button class="delete-url" data-aweme="${v.aweme_id}">Delete</button>
        `;
        g.appendChild(card);
      });
      bindDeleteUrls();
    }

    // Fetch & render saved users with embedded videos
    async function fetchSavedUsers() {
      const res = await fetch('/api/saved-users');
      const users = await res.json();
      renderUserSection(users);
    }
    function renderUserSection(users) {
      const pu = document.getElementById('page-users');
      const grid = pu.querySelector('.users-grid');
      grid.innerHTML = '';
      users.forEach(u => {
        const entry = document.createElement('div');
        entry.className = 'user-entry';
        // build profile card
        const profile = document.createElement('div');
        profile.className = 'user-card';
        profile.innerHTML = `
          <img src="${u.avatar}" alt="${u.username}"/>
          <span class="handle">${u.username}</span>
        `;
        entry.appendChild(profile);

        // embedded videos container (hidden by default)
        const vids = document.createElement('div');
        vids.className = 'videos-container';
        if (Array.isArray(u.videos) && u.videos.length) {
          const vidGrid = document.createElement('div');
          vidGrid.className = 'grid';
          u.videos.forEach(v => {
            const c = document.createElement('div');
            c.className = 'card';
            c.innerHTML = `
              <video controls data-aweme-id="${v.aweme_id}">
                <source src="${v.play_url}" type="video/mp4">
              </video>
              <div class="title">${v.text||('Video '+v.aweme_id)}</div>
              <div class="views" id="views-${v.aweme_id}">${v.play_count||0} views</div>
              <div class="card-buttons">
                <a href="${v.play_url}"><button>Play</button></a>
                <a href="${v.hd_url||v.play_url}"><button>HD</button></a>
              </div>
            `;
            vidGrid.appendChild(c);
          });
          vids.appendChild(vidGrid);
        }
        entry.appendChild(vids);

        // delete button
        const del = document.createElement('button');
        del.className = 'delete-user';
        del.dataset.username = u.username;
        del.textContent = 'Delete';
        entry.appendChild(del);

        grid.appendChild(entry);

        // toggle videos on profile click
        profile.addEventListener('click', () => {
          vids.style.display = vids.style.display === 'block' ? 'none' : 'block';
        });
      });
      bindDeleteUsers();
    }

    // video view increment
    document.body.addEventListener('play', async e => {
      if (e.target.tagName === 'VIDEO' && e.target.dataset.awemeId) {
        const id = e.target.dataset.awemeId;
        const r = await fetch(`/api/view/${id}`, { method: 'POST' });
        if (r.ok) {
          const { play_count } = await r.json();
          const el = document.getElementById(`views-${id}`);
          if (el) el.textContent = `${play_count} views`;
        }
      }
    }, true);

    // init
    async function initApp() {
      highlightNav();
      await fetchSavedUrls();
      await fetchSavedUsers();
    }
    window.addEventListener('load', async () => {
      document.getElementById('loader').classList.add('fade-out');
      setTimeout(async () => {
        document.getElementById('loader').style.display = 'none';
        const token = localStorage.getItem('tikify_token');
        if (token) {
          document.getElementById('auth-container').style.display = 'none';
          document.getElementById('app-content').style.display = 'block';
          initAuth();
          await initApp();
        } else {
          document.getElementById('app-content').style.display = 'none';
          document.getElementById('auth-container').style.display = 'flex';
          initAuth();
        }
      }, 600);
    });

    // keep-alive ping
    setInterval(() => fetch('/ping').catch(() => {}), 300000);
  </script>
</body>
</html>
